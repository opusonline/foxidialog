/*!
 * jquery foxidialog 1.0
 *
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses. (LICENSES.txt)
 */
(function(A){var O=A(window),s=A(document),e=A("#foxidialog"),G=A("#foxidialog-overlay"),J=A("#foxidialog-loading"),j,R,g,m,c,p,l,v,i,E,K=".foxidialog",b=false,D=false,I=new Image(),h=/^#.+/,M=/\.(jpg|gif|png|bmp|jpeg)$/i,F=/^javascript:/i,H=/^(\d+)%$/,t=Math.max,Q=Math.min,B,C={speed:250,margin:30,overlayOpacity:0.4,overlayColor:"#222",type:"",href:"",title:"",content:"",ajax:{},buttons:[],width:560,height:340,maxWidth:null,maxHeight:null,autoSize:true,onStart:function(){},onComplete:function(){},onClosed:function(){},onCancel:function(){},onError:function(){}},n={esc:27,},N=function(){return{width:O.width(),height:O.height(),top:s.scrollTop(),left:s.scrollLeft()}},a=function(S){if(!b){return}if(S.keyCode==n.esc){S.preventDefault();A.foxidialog.close()}},P=function(){var S={display:"none"};if(!e.length){var T='<div class="head"><span class="title"></span><a href="javascript:void(0)" class="close">close</a></div><div class="wrap"/>';A("body").append(e=A("<div/>").attr("id","foxidialog").css(S).append(T),G=A("<div/>").attr("id","foxidialog-overlay").css(S).click(A.foxidialog.close),J=A("<div/>").attr("id","foxidialog-loading").css(S).click(A.foxidialog.cancel),j=A("<div/>").attr("id","foxidialog-temp").css({display:"none",position:"absolute",top:0,left:0}))}R=A("div.wrap",e);g=A("span.title",e);m=A("a.close",e).click(A.foxidialog.close);E={width:e.outerWidth(),height:e.outerHeight()}},x=function(){v.onStart.call(i.pointer);z();D=false;var T=i.source,S=h.test(T)?"inline":M.test(T)?"image":v.content?"html":"ajax";if(v.type){S=v.type}if(i.is_iframe){S="iframe"}if(S=="iframe"){k()}else{if(S=="html"){L()}else{if(S=="inline"){r()}else{if(S=="image"){d()}else{if(S=="ajax"){o()}}}}}},d=function(){A.foxidialog.showLoading();I=new Image();I.onload=q;I.onerror=y;I.src=i.source},o=function(){A.foxidialog.showLoading();var S=v.href||i.source;B=A.ajax(A.extend({},{url:S,success:L,error:y},v.ajax))},z=function(){J.hide();I.onload=I.onerror=null;if(B){B.abort();B=null}},y=function(){var T=arguments[2]||'"'+i.source+'" not found.',S="Load Error! "+T;v.onError.call(i.pointer);L(S)},q=function(){A.foxidialog.hideLoading();D=true;c=A("<img/>").attr({src:I.src,alt:i.title}).css({width:I.width,height:I.height,"vertical-align":"middle"});f()},k=function(){c=A("<iframe/>").attr({src:i.source,name:"foxidialog-iframe",frameborder:0}).css({width:v.width,height:v.height,"vertical-align":"middle"});f()},r=function(){var S=v.href||i.source;c=A(S).after(p=A("<div/>")).show();f()},L=function(){A.foxidialog.hideLoading();var S=arguments[0]||v.content;c=A("<div/>").html(S);f()},f=function(){u();var X=i.title||"&nbsp;";g.html(X);R.empty().append(c);if(v.buttons.length){w()}var T=N(),W=e.outerWidth(),S=e.outerHeight(),V=t((T.height-S)/2+T.top,0),U=t((T.width-W)/2+T.left,0);G.css({opacity:v.overlayOpacity,background:v.overlayColor}).fadeIn(v.speed);e.css({top:V,left:U}).fadeIn(v.speed,function(){b=true;v.onComplete.call(i.pointer)})},w=function(){l=A("<div/>").attr("class","buttons").insertAfter(R);var T=v.buttons,U=function(V){A(this).data("callback").call(c,V)};for(var S in T){A("<button/>").attr({type:"button"}).data("callback",T[S].click).html(T[S].text).click(U).appendTo(l)}},u=function(){c.appendTo(j);var Y=N(),X=j.width(),T=j.height(),aa=Y.width-E.width-v.margin*2,W=Y.height-E.height-v.margin*2,Z=v.maxWidth,S=v.maxHeight,U,V;if(i.is_iframe||!v.autoSize){X=v.width;T=v.height}if(Z){U=Z.toString(10).match(H);aa=U?aa/100*Q(U[1],100):Q(Z,aa)}if(S){U=S.toString(10).match(H);W=U?W/100*Q(U[1],100):Q(S,W)}if(T>W){if(D){V=X/T;T=W;X=T*V}else{T=W}}if(X>aa){if(D){V=T/X;X=aa;T=X*V}else{X=aa}}c.css({width:X,height:T})};A.fn.foxidialog=function(S){var S=A.extend({},C,S);return this.each(function(){var W=A(this),X=S.href||W.attr("href"),Y=S.title||W.attr("title")||"",V=W.hasClass("iframe"),U={pointer:W,source:X,title:Y,is_iframe:V},T=function(Z){Z.preventDefault();v=S;i=U;x()};if(!X||F.test(X)||X=="#"){return}W.removeAttr("title").unbind(K).bind("click"+K,T)})};A.foxidialog=function(S){if(!S){return}var T=S.type=="iframe"?true:false;v=A.extend({},C,S);i={pointer:document,source:v.href,title:v.title,is_iframe:T};x()};A.foxidialog.defaults=function(S){A.extend(C,S)};A.foxidialog.showLoading=function(){J.show()};A.foxidialog.hideLoading=function(){J.hide()};A.foxidialog.cancel=function(){if(!i){A.foxidialog.hideLoading();return}v.onCancel.call(i.pointer);z()};A.foxidialog.close=function(){z();G.fadeOut(v.speed);e.fadeOut(v.speed,function(){b=false;if(p){p.after(c.hide()).remove();p=null}if(l){l.remove();l=null}e.css({top:0,left:0});v.onClosed.call(i.pointer)})};P();O.unbind(K).bind("keydown"+K,a)})(jQuery);